# 编码说明

## ANSI编码选项

### 什么是ANSI编码？

在Windows中文系统中，ANSI编码通常指 **GBK编码**（或GB2312），是Windows中文环境的默认编码。

### 为什么需要ANSI编码？

小灰熊歌词软件是基于Delphi/Pascal开发的Windows应用程序，通常期望文件使用 **ANSI（GBK）编码**。

### 编码对比

| 编码类型 | 优点 | 缺点 | 适用场景 |
|---------|------|------|---------|
| **ANSI (GBK)** | • 兼容小灰熊软件<br>• Windows中文系统原生支持 | • 跨平台兼容性差<br>• 不支持某些Unicode字符 | 推荐：小灰熊软件使用 |
| **UTF-8** | • 通用编码标准<br>• 跨平台兼容<br>• 支持所有Unicode字符 | • 某些老软件可能不识别 | 推荐：其他用途 |

## 智能编码处理（重要）

### 自动降级机制

程序内置了智能编码处理：

✅ **勾选ANSI编码时**
- 优先使用GBK编码保存
- **如果遇到GBK不支持的字符（如韩文、emoji）**
  - 自动降级为UTF-8编码
  - 转换完成后会提示哪些文件使用了UTF-8
  - 不会导致转换失败

💡 **这意味着**：您可以放心勾选ANSI编码，程序会自动处理特殊字符！

### 使用建议

### 默认设置（推荐）

✅ **勾选"转换为ANSI编码（GBK）"**（默认）

- 适合直接在小灰熊软件中使用
- 避免乱码问题
- Windows中文系统完美兼容
- **遇到特殊字符自动降级为UTF-8**

### 特殊场景

如果您需要：
- 在Mac/Linux系统使用
- 确保所有文件统一使用UTF-8
- 需要跨平台共享文件

则可以 **取消勾选** 使用UTF-8编码。

## 常见问题

### Q1：我的歌词包含韩文，勾选ANSI会失败吗？

**答**：不会！程序会自动检测，如果GBK无法编码韩文，会自动使用UTF-8保存该文件。转换完成后会提示您哪些文件使用了UTF-8。

**示例**：
- 批量转换100个文件
- 其中23个包含韩文
- 结果：77个用GBK，23个自动用UTF-8
- 提示："23个文件包含韩文/特殊字符，已自动使用UTF-8编码保存"

### Q2：输出文件乱码怎么办？

**原因**：编码不匹配

**解决方案**：
1. 如果小灰熊软件显示乱码 → 勾选"转换为ANSI编码（GBK）"
2. 如果其他软件显示乱码 → 取消勾选，使用UTF-8编码

### Q3：两种编码输出的内容有区别吗？

**答**：内容完全相同，只是保存文件的编码格式不同。就像同一段文字可以用简体或繁体显示，内容是一样的。

### Q3：输入文件的编码要求是什么？

**答**：输入文件可以是任何编码！程序会自动检测并正确读取。支持的编码包括：
- UTF-8
- UTF-8 BOM
- GBK/GB2312（中文简体）
- Big5（中文繁体）
- Shift-JIS（日文）
- EUC-KR（韩文）

### Q4：我不知道该选哪个？

**答**：保持默认勾选（ANSI/GBK），这是最安全的选择，适合大多数情况。

## 技术细节

### 代码实现

```python
# 获取编码选项
use_ansi = self.ansi_checkbox.isChecked()
output_encoding = 'gbk' if use_ansi else 'utf-8'

# 保存文件
with open(output_path, 'w', encoding=output_encoding) as f:
    f.write(output_content)
```

### 编码转换流程

```
输入文件（任意编码）
    ↓
程序自动检测编码
    ↓
转换为Python内部Unicode
    ↓
处理和转换歌词格式
    ↓
根据用户选择输出：
    • ANSI (GBK) - 默认
    • UTF-8
```

## 推荐配置

### 场景1：纯中文歌词
✅ 使用 **ANSI (GBK)** - 默认勾选

### 场景2：英文/日文/韩文歌词
✅ 使用 **ANSI (GBK)** - 默认勾选（GBK支持中日韩统一表意文字）

### 场景3：包含Emoji表情
⚠️ 可能需要 **UTF-8**（取消勾选）
- GBK不支持Emoji
- 如果歌词包含😊🎵等表情，使用UTF-8

### 场景4：生僻字或特殊符号
⚠️ 可能需要 **UTF-8**（取消勾选）
- 如果GBK不支持某些字符，会出现错误
- 程序会提示转换失败

## 总结

| 使用场景 | 推荐编码 | 勾选状态 |
|---------|---------|---------|
| 小灰熊软件使用 | ANSI (GBK) | ✅ 勾选（默认）|
| 包含Emoji | UTF-8 | ❌ 取消勾选 |
| 跨平台使用 | UTF-8 | ❌ 取消勾选 |
| 不确定 | ANSI (GBK) | ✅ 勾选（默认）|

**最简单的原则：不确定就保持默认！** ✅


