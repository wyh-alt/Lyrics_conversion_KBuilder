# 打包说明 - 生成EXE可执行文件

## 快速开始

### 方法1：使用批处理脚本（推荐）

1. **双击运行** `build_exe.bat`
2. 等待打包完成
3. 在 `dist` 文件夹中找到 `小灰熊歌词转换器.exe`

### 方法2：手动打包

```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 打包
pyinstaller --name="小灰熊歌词转换器" --windowed --onefile lyric_converter.py

# 3. 找到exe文件
# 位置：dist\小灰熊歌词转换器.exe
```

---

## 打包命令详解

### 基础打包命令

```bash
pyinstaller --name="小灰熊歌词转换器" --windowed --onefile lyric_converter.py
```

### 参数说明

| 参数 | 说明 |
|------|------|
| `--name="小灰熊歌词转换器"` | 生成的exe文件名 |
| `--windowed` | 不显示控制台窗口（GUI程序） |
| `--onefile` | 打包成单个exe文件 |
| `lyric_converter.py` | 主程序文件 |

### 完整打包命令（推荐）

```bash
pyinstaller --name="小灰熊歌词转换器" \
    --windowed \
    --onefile \
    --icon=NONE \
    --hidden-import=PyQt6.QtCore \
    --hidden-import=PyQt6.QtGui \
    --hidden-import=PyQt6.QtWidgets \
    --clean \
    lyric_converter.py
```

### 高级参数说明

| 参数 | 说明 |
|------|------|
| `--icon=NONE` | 不设置图标（可替换为.ico文件路径） |
| `--hidden-import=...` | 显式导入PyQt6模块 |
| `--clean` | 清理临时文件 |
| `--noupx` | 不使用UPX压缩（避免杀毒软件误报） |
| `--noconfirm` | 覆盖输出目录不询问 |

---

## 打包后的文件

### 目录结构

```
项目根目录/
├── build/              # 临时构建文件（可删除）
├── dist/               # 输出目录
│   └── 小灰熊歌词转换器.exe  # 可执行文件 ⭐
└── 小灰熊歌词转换器.spec  # 打包配置（可删除）
```

### 文件大小

- **基础打包**：约 50-80 MB
- **完整打包**：约 80-120 MB

**说明**：文件较大是因为包含了Python解释器和所有依赖库（PyQt6等）

---

## 使用打包后的EXE

### 分发方式

1. **直接复制exe文件**
   - 将 `小灰熊歌词转换器.exe` 复制到U盘
   - 或上传到网盘分享
   - 或通过邮件发送

2. **目标电脑要求**
   - ✅ Windows 7 或更高版本
   - ✅ 无需安装Python
   - ✅ 无需安装任何依赖
   - ✅ 双击即可运行

### 首次运行

- 首次运行可能稍慢（解压临时文件）
- 某些杀毒软件可能提示（误报），添加到白名单即可
- 建议右键"以管理员身份运行"（如果遇到权限问题）

---

## 常见问题

### Q1：打包失败，提示找不到模块

**解决方案**：
```bash
# 确保所有依赖已安装
pip install -r requirements.txt

# 使用完整打包命令（包含所有隐藏导入）
pyinstaller --name="小灰熊歌词转换器" --windowed --onefile --collect-all=PyQt6 lyric_converter.py
```

### Q2：生成的exe文件很大

**原因**：包含了Python解释器和所有依赖

**优化方案**：
- 使用 `--onefile` 已经是单文件模式
- 文件大小是正常的（PyQt6比较大）
- 无法进一步减小

### Q3：exe运行报错

**可能原因**：
1. 缺少Visual C++运行库
   - 下载安装：Microsoft Visual C++ Redistributable
2. 杀毒软件拦截
   - 添加到白名单
3. 权限不足
   - 右键"以管理员身份运行"

### Q4：如何添加图标？

**步骤**：
1. 准备 `.ico` 图标文件
2. 修改打包命令：
```bash
pyinstaller --name="小灰熊歌词转换器" --windowed --onefile --icon=icon.ico lyric_converter.py
```

### Q5：如何减小文件大小？

**方法**：
- 使用虚拟环境，只安装必要依赖
- 使用 `--exclude-module` 排除不需要的模块
- 但效果有限，PyQt6本身很大

---

## 高级配置

### 创建spec文件（自定义配置）

```bash
# 生成spec文件
pyinstaller --name="小灰熊歌词转换器" --windowed --onefile lyric_converter.py

# 编辑 小灰熊歌词转换器.spec
# 然后使用spec文件打包
pyinstaller 小灰熊歌词转换器.spec
```

### spec文件示例

```python
# -*- mode: python ; coding: utf-8 -*-

block_cipher = None

a = Analysis(
    ['lyric_converter.py'],
    pathex=[],
    binaries=[],
    datas=[('README.md', '.')],
    hiddenimports=['PyQt6.QtCore', 'PyQt6.QtGui', 'PyQt6.QtWidgets'],
    hookspath=[],
    hooksconfig={},
    runtime_hooks=[],
    excludes=[],
    win_no_prefer_redirects=False,
    win_private_assemblies=False,
    cipher=block_cipher,
    noarchive=False,
)

pyz = PYZ(a.pure, a.zipped_data, cipher=block_cipher)

exe = EXE(
    pyz,
    a.scripts,
    a.binaries,
    a.zipfiles,
    a.datas,
    [],
    name='小灰熊歌词转换器',
    debug=False,
    bootloader_ignore_signals=False,
    strip=False,
    upx=True,
    upx_exclude=[],
    runtime_tmpdir=None,
    console=False,
    disable_windowed_traceback=False,
    argv_emulation=False,
    target_arch=None,
    codesign_identity=None,
    entitlements_file=None,
)
```

---

## 测试打包结果

### 测试步骤

1. **在开发机器测试**
   ```bash
   # 运行exe
   dist\小灰熊歌词转换器.exe
   ```

2. **在干净系统测试**
   - 找一台没有Python的Windows电脑
   - 复制exe文件过去
   - 双击运行测试

3. **功能测试**
   - ✅ 打开程序
   - ✅ 拖拽文件
   - ✅ 转换歌词
   - ✅ 查看输出

---

## 分发建议

### 打包清单

- [ ] 生成exe文件
- [ ] 在干净系统测试
- [ ] 准备使用说明（可选）
- [ ] 准备README（可选）

### 推荐文件结构

```
小灰熊歌词转换器/
├── 小灰熊歌词转换器.exe  # 主程序
├── README.txt            # 使用说明（可选）
└── 示例歌词.txt          # 示例文件（可选）
```

---

## 总结

### 快速打包

```bash
# 最简单的方式
双击运行 build_exe.bat
```

### 打包后

- ✅ 单个exe文件，无需安装
- ✅ 可在任意Windows电脑运行
- ✅ 无需Python环境
- ✅ 双击即可使用

### 注意事项

- ⚠️ 文件较大（50-120MB）
- ⚠️ 首次运行可能稍慢
- ⚠️ 可能被杀毒软件误报（添加到白名单）

---

**祝打包顺利！** 🎉

