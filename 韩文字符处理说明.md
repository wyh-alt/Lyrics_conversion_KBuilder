# 韩文字符处理说明

## 问题说明

### 遇到的错误
```
'gbk' codec can't encode character '\ud558' in position 198: illegal multibyte sequence
```

### 原因分析
- **GBK编码**主要支持中文字符
- **韩文字符**（한글）不在GBK编码范围内
- 当勾选"转换为ANSI编码（GBK）"时，包含韩文的文件无法保存

---

## 解决方案

### ✅ 智能自动降级机制

程序现已添加**智能编码降级**功能：

```
勾选ANSI编码（GBK）
    ↓
尝试用GBK保存文件
    ↓
是否成功？
    ├── 成功 → 使用GBK保存 ✅
    └── 失败（遇到韩文等）→ 自动降级为UTF-8 ✅
```

### 工作流程

1. **用户勾选ANSI编码**
2. **程序尝试GBK保存**
3. **遇到韩文字符** → 捕获 `UnicodeEncodeError`
4. **自动改用UTF-8** → 保存成功
5. **记录降级文件** → 转换完成后提示用户

---

## 实际效果

### 转换结果示例

假设批量转换100个文件：
- 77个纯中文/英文歌词 → 使用GBK编码 ✅
- 23个包含韩文歌词 → 自动使用UTF-8编码 ✅

### 结果提示
```
┌───────────────────────────────────────────┐
│ 转换成功！                                │
│                                           │
│ 共转换 100 个文件                         │
│                                           │
│ 注意：23 个文件包含韩文/特殊字符          │
│ 已自动使用UTF-8编码保存                   │
│                                           │
│ 输出目录: C:\output\                      │
└───────────────────────────────────────────┘

点击"显示详细信息"可查看具体哪些文件使用了UTF-8
```

---

## 支持的特殊字符

以下字符在GBK中无法编码，会自动降级为UTF-8：

### 韩文（한글）
```
사랑해요, 안녕하세요, 너, 우리, 별, 하늘, 그대 等
```

### Emoji表情
```
😊 💕 🎵 🎶 ❤️ 🌟 等
```

### 其他Unicode字符
- 生僻汉字
- 某些符号
- 特殊语言字符

---

## 用户操作

### 推荐做法（最简单）

✅ **保持默认勾选"转换为ANSI编码（GBK）"**

- 不用担心转换失败
- 不用手动选择编码
- 程序自动智能处理
- 混合文件也能正确转换

### 结果说明

转换完成后：
1. **查看主提示** → 知道有多少文件成功转换
2. **点击"显示详细信息"** → 查看哪些文件使用了UTF-8
3. **打开输出文件夹** → 所有文件都已正确保存

---

## 技术实现

### 代码逻辑

```python
try:
    # 尝试用GBK保存
    with open(output_path, 'w', encoding='gbk') as f:
        f.write(output_content)
    success_count += 1
except UnicodeEncodeError:
    # GBK失败，自动降级为UTF-8
    with open(output_path, 'w', encoding='utf-8') as f:
        f.write(output_content)
    success_count += 1
    utf8_fallback_files.append(filename)
```

### 错误捕获

- `UnicodeEncodeError` → GBK无法编码某个字符
- 自动切换为UTF-8
- 记录文件名到降级列表
- 继续处理下一个文件

---

## 兼容性说明

### 小灰熊软件支持

**UTF-8编码的文件在小灰熊软件中也能正常使用**

- 现代版本的小灰熊软件支持UTF-8
- 如果出现问题，可以在软件中指定编码
- 大多数情况下无需特别设置

### 最佳实践

| 文件类型 | 自动使用编码 | 兼容性 |
|---------|------------|--------|
| 纯中文 | GBK | ✅ 完美 |
| 中英混合 | GBK | ✅ 完美 |
| 包含韩文 | UTF-8（自动） | ✅ 良好 |
| 包含日文 | GBK | ✅ 完美 |
| 包含Emoji | UTF-8（自动） | ⚠️ 取决于软件版本 |

---

## 常见问题

### Q1：为什么有些文件用UTF-8，有些用GBK？

**A**：根据文件内容智能选择
- 能用GBK的就用GBK（更好的兼容性）
- 不能用GBK的自动用UTF-8（避免失败）

### Q2：混合编码会不会有问题？

**A**：不会！
- 每个文件独立保存
- 各自使用最合适的编码
- 小灰熊软件能正确识别

### Q3：我能强制全部使用UTF-8吗？

**A**：可以！取消勾选"转换为ANSI编码（GBK）"即可。

### Q4：为什么不默认全用UTF-8？

**A**：因为GBK在Windows中文环境和小灰熊软件中有更好的兼容性。我们采用"优先GBK，必要时UTF-8"的策略。

---

## 总结

### ✅ 优点

1. **用户无需操心** → 自动处理
2. **不会转换失败** → 智能降级
3. **最优编码选择** → 能用GBK就用GBK
4. **清晰的提示** → 知道哪些文件用了UTF-8

### 💡 建议

**保持默认设置，放心转换！** 😊

无论歌词是中文、英文、日文、韩文还是混合，程序都能正确处理！


